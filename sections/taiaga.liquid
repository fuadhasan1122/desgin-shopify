<script src="https://cdn.tailwindcss.com"></script>

<style>
  .topbar-animate {
    display: inline-block;
    white-space: nowrap;
    animation-name: topbarSlide;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }

  @keyframes topbarSlide {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(var(--slide-distance));
    }
  }
</style>

<div id="announcement-bar" class="transition-all duration-300 ease-in-out overflow-hidden" style="background-color: {{ section.settings.bg_color }};color: {{ section.settings.text_color }};">
  <div class="max-w-[1300px] flex justify-between h-auto py-6 mx-auto uppercase items-center font-bold">
    <a href="{{ section.settings.link_1 }}" class="flex italic underline hover:opacity-80">{{ section.settings.text_1 }}</a>
    <a href="{{ section.settings.link_2 }}" class="flex hover:opacity-80">{{ section.settings.text_2 }}</a>
    <a href="{{ section.settings.link_3 }}" class="flex italic underline hover:opacity-80">{{ section.settings.text_3 }}</a>
  </div>
</div>

<section
  class="relative min-h-[420px] sm:min-h-[550px] md:min-h-[700px] lg:min-h-[900px] bg-cover bg-center"
  style="background: linear-gradient(90deg, #FDE047 0%, #FB923C 30%, #EC4899 70%, #2DD4BF 100%), url('{{ section.settings.hero_bg_image | img_url: '1800x' }}'); background-blend-mode: overlay; background-size: cover; background-position: center;"
>
  <header
    id="header-nav"
    class="
      w-full z-50 flex items-center justify-between
      px-0 py-[40px] lg:px-[60px] py-6 mt-0 text-black fixed bg-transparent transition-all duration-300 hover:bg-white/90
    "
  >
    <!-- LEFT -->
    <nav class="flex items-center gap-6">
      <button id="open-menu" class="p-2 hover:bg-black/5 rounded-full transition-colors">
        <svg class="w-7 h-7 md:w-9 md:h-9" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>

      <div class=" md:flex space-x-2 sm:space-x-8 text-3xl">
        <a href="/" class="uppercase font-bold hover:text-pink-800">Home</a>
        <a href="/collections/all" class="uppercase font-bold hover:text-pink-800">Shop</a>
        <a href="/pages/about" class="uppercase font-bold hover:text-pink-800">About</a>
      </div>
    </nav>

    <!-- CENTER LOGO -->
    <div class="absolute left-1/2 -translate-x-1/2">
      {% if section.settings.logo_img != blank %}
        <a href="/">
          <img
            src="{{ section.settings.logo_img | img_url: '400x' }}"
            class="w-20 sm:w-28 md:w-36 lg:w-44 transition-all"
          >
        </a>
      {% else %}
        <a href="/" class="text-3xl md:text-5xl font-black italic">Taiga</a>
      {% endif %}
    </div>

    <!-- RIGHT -->
    <div class="flex items-center gap-[25px]">
      <img src="https://flagcdn.com/w80/us.png" class="w-[30px] h-[30px] rounded-full object-cover">

      <button>
        <svg
          class="w-[30px] h-[30px]"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>

      <button class="">
        <svg
          class="w-[30px] h-[30px]"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0z
               M12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
      </button>

      <button class="relative">
        <svg
          class="w-[30px] h-[30px]"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-width="2"
            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <span
          class="
            absolute -top-1 -right-1 bg-pink-600 text-white
            text-[10px] w-4 h-4 rounded-full flex items-center justify-center
          "
        ></span>
      </button>
    </div>
  </header>

 <div class="absolute bottom-0 left-0 w-full pointer-events-none z-20">
  
  <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto translate-y-[2px]">
    <defs>
      <linearGradient id="gradient-back" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#09ec3e; stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#96b703; stop-opacity:0.9" />
      </linearGradient>

      <linearGradient id="gradient-middle" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#d0d53a; stop-opacity:0.6" />
        <stop offset="100%" style="stop-color:#11bfda; stop-opacity:0.6" />
      </linearGradient>
    </defs>

    <path fill="url(#gradient-back)" d="M0,160 C320,300 420,100 640,200 C860,300 1120,150 1440,250 L1440,320 L0,320 Z"></path>
    <path fill="url(#gradient-middle)" d="M0,200 C240,150 480,300 720,220 C960,140 1200,280 1440,200 L1440,320 L0,320 Z"></path>
    <path fill="#ffffff" d="M0,260 C160,240 320,210 480,220 C640,230 800,260 960,250 C1120,240 1280,220 1440,235 L1440,320 L0,320 Z"></path>
  </svg>
</div>




</section>
<div class="relative z-30 bg-white py-20 px-6">
  <div class="max-w-[900px] mx-auto text-center">
    <h2 class="text-3xl md:text-5xl leading-[1.4] text-gray-800 font-medium tracking-tight">
      {{ section.settings.under_wave_text_1 }} 
      <span class="text-[#e50b9c] font-bold underline decoration-4 underline-offset-8">
        {{ section.settings.under_wave_highlight_1 }}
      </span> 
      {{ section.settings.under_wave_text_2 }} 
      <span class="text-[#e50b9c] font-bold underline decoration-4 underline-offset-8">
        {{ section.settings.under_wave_highlight_2 }}
      </span>.
    </h2>
  </div>
</div>

<!-- MENU SCRIPT -->
<script>
  const openBtn = document.getElementById('open-menu');
  const closeBtn = document.getElementById('close-menu');
  const menu = document.getElementById('mobile-menu');
  const backdrop = document.getElementById('menu-backdrop');
  const content = document.getElementById('menu-content');

  function toggleMenu(open) {
    if (open) {
      menu.classList.remove('invisible');
      backdrop.classList.replace('opacity-0', 'opacity-100');
      content.classList.replace('translate-x-[-100%]', 'translate-x-0');
      document.body.style.overflow = 'hidden';
    } else {
      backdrop.classList.replace('opacity-100', 'opacity-0');
      content.classList.replace('translate-x-0', 'translate-x-[-100%]');
      setTimeout(() => {
        menu.classList.add('invisible');
        document.body.style.overflow = '';
      }, 300);
    }
  }

  openBtn.onclick = () => toggleMenu(true);
  closeBtn.onclick = () => toggleMenu(false);
  backdrop.onclick = () => toggleMenu(false);
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (!{{ section.settings.topbar_animation_enable | json }}) return;

    const speed = {{ section.settings.topbar_animation_speed | default: 12 }};
    const direction = "{{ section.settings.topbar_animation_direction }}";

    const distance = direction === "right" ? "100%" : "-100%";

    document.querySelectorAll(
      '[href="{{ section.settings.link_1 }}"],' +
      '[href="{{ section.settings.link_2 }}"],' +
      '[href="{{ section.settings.link_3 }}"]'
    ).forEach(el => {
      el.classList.add("topbar-animate");
      el.style.setProperty("--slide-distance", distance);
      el.style.animationDuration = speed + "s";
    });
  });
</script>

<script>
  window.addEventListener('scroll', function () {
    const header = document.getElementById('header-nav');
    const announcementBar = document.getElementById('announcement-bar');
    
    if (window.scrollY > 50) {
      // 1. Style the Navigation Header
      header.classList.add('bg-white/95', 'shadow-md');
      header.classList.remove('bg-transparent');
      
      // 2. Remove the GAP: Move header to the absolute top
      header.style.top = '0';
      
      // 3. Hide the Announcement Bar
      if (announcementBar) {
        announcementBar.style.maxHeight = '0px';
        announcementBar.style.opacity = '0';
      }
    } else {
      // 1. Reset Navigation Header
      header.classList.add('bg-transparent');
      header.classList.remove('bg-white/95', 'shadow-md');
      
      // 2. Restore the GAP (if you want it back when at the very top)
      // If you want the header to stay at the top always, leave this as '0'
      header.style.top = ''; 
      
      // 3. Show the Announcement Bar
      if (announcementBar) {
        announcementBar.style.maxHeight = '200px'; // Tall enough to fit content
        announcementBar.style.opacity = '1';
      }
    }
  });
</script>

<div
  id="promo-popup"
  class="fixed inset-0 z-[100] flex items-center justify-center invisible opacity-0 transition-all duration-500"
>
  <div id="popup-backdrop" class="absolute inset-0 bg-black/60 backdrop-blur-xl"></div>

  <div
    id="popup-card"
    class="relative w-[90%] max-w-[500px] min-h-[50vh] md:min-h-[700px] bg-[#e50b9c] rounded-[40px] p-10 md:p-12 shadow-2xl flex flex-col justify-between items-center transform scale-90 translate-y-10 transition-all duration-500"
  >
    <button id="close-popup" class="absolute top-8 right-8 text-white/80 hover:text-white transition-colors z-10">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <div class="w-full text-left">
      <h3 class="text-xl font-black italic text-white uppercase tracking-tight">Limited time only!</h3>
    </div>

    <div class="relative flex-1 flex items-center justify-center py-6">
      <img
        src="{{ section.settings.popup_image | img_url: '800x' }}"
        class="h-[320px] md:h-[420px] w-auto object-contain drop-shadow-[0_20px_40px_rgba(0,0,0,0.4)]"
        alt="Promo Product"
      >
      
    </div>

    <div class="w-full">
      <div class="text-left text-white mb-8">
        <p class="text-2xl md:text-3xl font-black leading-tight uppercase">
          üçπ Buy 5 Kombuchas,<br>
          Get 1 FREE!
        </p>
        <p class="text-lg opacity-90 mt-2 font-medium">Stock up on your favorites ‚Äî your 6th bottle is on us.</p>
      </div>

      <a
        href="/collections/all"
        class="block w-full bg-white text-[#e50b9c] py-5 rounded-full text-xl font-black hover:bg-gray-100 transition-all text-center uppercase tracking-widest shadow-lg"
      >
        Browse products
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('promo-popup');
    const card = document.getElementById('popup-card');
    const closeBtn = document.getElementById('close-popup');
    const backdrop = document.getElementById('popup-backdrop');

    const STORAGE_KEY = 'taiga_promo_dismissed';

    function openPopup() {
      console.log('Showing Promo Popup...');
      if (popup && card) {
        popup.classList.remove('invisible', 'opacity-0');
        setTimeout(() => {
          card.classList.remove('scale-90', 'translate-y-10');
          card.classList.add('scale-100', 'translate-y-0');
        }, 50);
        document.body.style.overflow = '';
      }
    }

    function closePopup() {
      if (popup && card) {
        popup.classList.add('opacity-0');
        card.classList.add('scale-90', 'translate-y-10');

        // Save dismissal to localStorage
        localStorage.setItem(STORAGE_KEY, 'true');

        setTimeout(() => {
          popup.classList.add('invisible');
          document.body.style.overflow = '';
        }, 500);
      }
    }

    // Increased delay slightly to 3 seconds for better UX
    setTimeout(openPopup, 3000);

    if (closeBtn) closeBtn.onclick = closePopup;
    if (backdrop) backdrop.onclick = closePopup;

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePopup();
    });
  });
</script>

{% schema %}
{
  "name": "Taiga Full Page",
  "settings": [
    {
      "type": "header",
      "content": "Top Bar Settings"
    },
    { "type": "color", "id": "bg_color", "label": "Bar Background", "default": "#e50b9c" },
    { "type": "color", "id": "text_color", "label": "Bar Text", "default": "#ffffff" },
    { "type": "text", "id": "text_1", "label": "Left Text", "default": "BOTTLES: BUY 5 GET 1 FREE!" },
    { "type": "url", "id": "link_1", "label": "Left Link" },
    { "type": "text", "id": "text_2", "label": "Center Text", "default": "FREE SHIPPING TO ORDERS ABOVE $99" },
    { "type": "url", "id": "link_2", "label": "Center Link" },
    { "type": "text", "id": "text_3", "label": "Right Text", "default": "NOW AVAILABLE IN CANS!" },
    { "type": "url", "id": "link_3", "label": "Right Link" },
    {
      "type": "header",
      "content": "Hero Section"
    },
    { "type": "image_picker", "id": "hero_bg_image", "label": "Hero Background Texture" },
    { "type": "image_picker", "id": "logo_img", "label": "Logo Image" },
    {
      "type": "header",
      "content": "Under Wave Text"
    },
    { "type": "text", "id": "under_wave_text_1", "label": "Main Text Part 1", "default": "Indulge your taste buds in a symphony of flavors, from the crispness of our" },
    { "type": "text", "id": "under_wave_highlight_1", "label": "Pink Highlight 1", "default": "classic kombucha" },
    { "type": "text", "id": "under_wave_text_2", "label": "Main Text Part 2", "default": "to the exotic notes of our unique and" },
    { "type": "text", "id": "under_wave_highlight_2", "label": "Pink Highlight 2", "default": "exciting blends" },
    {
      "type": "header",
      "content": "Popup Settings"
    },
    { "type": "image_picker", "id": "popup_image", "label": "Popup Promo Image" },
    { "type": "text", "id": "popup_heading", "label": "Popup Title", "default": "Limited time only!" },
    { "type": "textarea", "id": "popup_subtext", "label": "Popup Promo Text", "default": "Buy 5 Kombuchas, Get 1 FREE! Stock up on your favorites ‚Äî your 6th bottle is on us." }
  ],
  "presets": [
    {
      "name": "Taiga Full Page"
    }
  ]
}
{% endschema %}